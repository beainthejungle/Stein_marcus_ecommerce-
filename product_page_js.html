<!doctype html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <script src="https://cdn.tailwindcss.com"></script>

        <title>Product page</title>
    </head>

    <body class="bg-slate-800">
        <nav class="py-12 px-8 bg-slate-700">
            <a href="." class="text-2xl text-white font-bold">Marcus Bike Shop</a>
        </nav>

        <main class="py-8 px-8">
            <div class="max-w-6xl mx-auto grid grid-cols-5 gap-6">
                <div class="col-span-3">
                    <figure class="p-6 bg-slate-700">
                        <img src="https://images.unsplash.com/photo-1485965120184-e220f721d03e?q=80&w=3570&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D" alt="Picture of a bicycle">
                    </figure>

                    <div class="mt-6 p-6 bg-slate-700 text-white">
                        <h1 class="mb-6 text-3xl font-bold">Customizable bicycle</h1>

                        <p>
                            Lorem ipsum dolor sit amet, consectetur adipiscing elit. Donec turpis sapien, pharetra in urna interdum, dictum hendrerit ante. Cras convallis lorem lectus, maximus vestibulum purus aliquam at. Maecenas tincidunt nibh libero, sit amet volutpat tortor vehicula quis. Nulla eleifend justo non dolor maximus, eu feugiat magna vulputate. Suspendisse purus eros, ultrices eu ornare in, viverra et sapien. Duis a sodales ante. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia curae; Proin iaculis mauris id lobortis laoreet. Proin consectetur a turpis non sagittis. Phasellus luctus magna aliquet, facilisis lorem sed, lacinia ex.
                        </p>
                    </div>
                </div>

                <div class="col-span-2 p-6 bg-slate-700 text-white space-y-6">
                    <h2 class="text-2xl font-bold">Details</h2>

                    <div class="py-4 px-6 bg-slate-400 rounded-xl grid grid-cols-5 gap-6 items-center text-slate-900">
                        <div class="col-span-1">
                            <figure>
                                <img src="https://static.thenounproject.com/png/5048549-200.png" class="w-8 h-8">
                            </figure>
                        </div>

                        <div class="col-span-4">
                            <h3 class="font-bold text-lg flex justify-between">
                                <span>Frame - Step-through</span>
                                <span>$180</span>
                            </h3>

                            <a href="#" class="show-modal underline" data-part="frame">Customize</a>
                        </div>
                    </div>

                    <div class="py-4 px-6 bg-slate-400 rounded-xl grid grid-cols-5 gap-6 items-center text-slate-900">
                        <div class="col-span-1">
                            <figure>
                                <img src="https://static.thenounproject.com/png/7099849-200.png" class="w-8 h-8">
                            </figure>
                        </div>

                        <div class="col-span-4">
                            <h3 class="font-bold text-lg flex justify-between">
                                <span>Frame finish - Glossy</span>
                                <span>$40</span>
                            </h3>

                            <a href="#" class="underline">Customize</a>
                        </div>
                    </div>

                    <div class="py-4 px-6 bg-slate-400 rounded-xl grid grid-cols-5 gap-6 items-center text-slate-900">
                        <div class="col-span-1">
                            <figure>
                                <img src="https://static.thenounproject.com/png/6468657-200.png" class="w-8 h-8">
                            </figure>
                        </div>

                        <div class="col-span-4">
                            <h3 class="font-bold text-lg flex justify-between">
                                <span>Wheels - Road wheels</span>
                                <span>$40</span>
                            </h3>

                            <a href="#" class="underline">Customize</a>
                        </div>
                    </div>

                    <div class="py-4 px-6 bg-slate-400 rounded-xl grid grid-cols-5 gap-6 items-center text-slate-900">
                        <div class="col-span-1">
                            <figure>
                                <img src="https://static.thenounproject.com/png/7099849-200.png" class="w-8 h-8">
                            </figure>
                        </div>

                        <div class="col-span-4">
                            <h3 class="font-bold text-lg flex justify-between">
                                <span>Rim color - Blue</span>
                                <span>$40</span>
                            </h3>

                            <a href="#" class="underline">Customize</a>
                        </div>
                    </div>

                    <div class="py-4 px-6 bg-slate-400 rounded-xl grid grid-cols-5 gap-6 items-center text-slate-900">
                        <div class="col-span-1">
                            <figure>
                                <img src="https://static.thenounproject.com/png/934919-200.png" class="w-8 h-8">
                            </figure>
                        </div>

                        <div class="col-span-4">
                            <h3 class="font-bold text-lg flex justify-between">
                                <span>Chain - 8-speed chain</span>
                                <span>$40</span>
                            </h3>

                            <a href="#" class="underline">Customize</a>
                        </div>
                    </div>

                    <button 
                        id="add-to-cart"
                        class="py-4 px-6 bg-sky-800 hover:bg-sky-600 transition rounded-xl"
                    >
                        Add to cart
                    </button>
                </div>
            </div>
        </main>

        <div class="modal hidden p-6 flex items-center justify-center fixed inset-0 bg-black bg-opacity-70" id="customize-modal">
            <div class="w-full max-w-5xl py-8 px-6 bg-slate-700 rounded-xl text-white">
                <div
                    id="modal-content" 
                    class="py-4 px-6 bg-slate-400 rounded-xl grid grid-cols-5 gap-6 text-slate-900"
                >
                </div>
            </div>
        </div>
    </body>

    <script>
        // 
        // Declare variables
        const productID = 1;
        const totalCost = 0;

        const chain = '';
        const frame = '';
        const wheels = '';
        const rimColor = '';
        const frameFinish = '';

        //
        // Get dom elements
        const addToCart = document.getElementById('add-to-cart');
        const modal = document.getElementById('customize-modal');
        const partButtons = document.querySelectorAll('.show-modal');
        const modalContent = document.getElementById('modal-content');

        //
        // Get variations from server when you click on a part
        partButtons.forEach(el => el.addEventListener('click', event => {
            fetch(`/products/${productID}/parts/${productPartID}/variations/`)
                .then((response) => response.json())
                .then((data) => {
                    let html = '<div class="col-span-1">';
                        html += '<figure class="flex justify-center"><img src="https://static.thenounproject.com/png/5048549-200.png" class="w-20 h-20"></figure>';
                        html += '</div>';
                        html += '<div class="col-span-4">';
                        html += '<h3 class="mb-6 font-bold text-2xl flex justify-between">';
                        html += `<span>${data.product_part.name}</span>`;
                        html += '<span>$0</span>';
                        html += '</h3>';
                        html += '<h4 class="mb-4 font-bold text-xl">Please select frame</h4>';
                        html += '</div>';

                    data.variations.forEach(variation => {
                        html += '<div class="mb-4 py-4 px-6 bg-slate-500 text-white flex justify-between items-center rounded-xl">';
                        html += '<div>';
                        html += `<h5 class="text-lg font-bold">${variation.name}</h5>`;
                        html += `<p class="text-slate-300">$${variation.display_price}</p>`;
                        html += '</div>';
                        html += `<button class="py-4 px-6 bg-sky-800 hover:bg-sky-600 transition text-white rounded-xl select-variation" data-variation="${variation.id}">Select</button>`;
                        html += '</div>';
                    })

                    modalContent.innerHTML = html;
                });

            modal.classList.remove('hidden');
        }));


        //
        // Function for calculating total cost
        const calculateTotalCost = () => {
            const data = new FormData();
            data.append('frame', frame);
            data.append('frameFinish', frameFinish);
            data.append('wheels', wheels);
            data.append('rimColor', rimColor);
            data.append('chain', chain);

            fetch('/cart/calculate-total-cost/', {
                method: 'post',
                body: data
            })
                .then((response) => response.json())
                .then((data) => {
                    totalCost = data.totalCost;

                    // Update UI
                });
        }


        //
        // Make it possible to select a variation in a modal
        const variationButtons = document.querySelectorAll('.select-variation');

        variationButtons.forEach(el => el.addEventListener('click', event => {
            console.log('ecent', event.target.getAttribute('data-variation'));

            fetch(`/can-add-variation/${el.target.getAttribute('data-variation')}/`)
                .then((response) => response.json())
                .then((data) => {
                    if (data.success) {
                        console.log('Variation can be added');

                        calculateTotalCost();

                        modal.classList.add('hidden');
                    } else {
                        console.log('Variation cannot be added, show an error');
                    }
                })
        }))


        //
        // Add to cart functionality
        addToCart.addEventListener('click', event => {
            console.log('Add to cart');

            const data = new FormData();
            data.append('frame', frame);
            data.append('frameFinish', frameFinish);
            data.append('wheels', wheels);
            data.append('rimColor', rimColor);
            data.append('chain', chain);

            fetch('/add-to-cart/', {
                method: 'post',
                body: data
            })
                .then((response) => response.json())
                .then((data) => {
                    if (data.success) {
                        console.log('Product successfully added to cart');
                    } else {
                        console.log('There was an error:', data.result);
                    }
                });
        })
    </script>
</html>